var autosave={config:{action:{},pointer:{},success:{},fail:{},before:{}},init:function(a,e){if(window.jQuery){if(null!=e){if("object"!=typeof e||""==a)return}else e={};if($.isArray(a))for(var t=0;t<a.length;t++)"string"==typeof a[t]?autosave.search(a[t],e):"string"==typeof a[t].pointer&&autosave.search(a[t].pointer,a[t]);else"object"==typeof a&&null!==a?"string"==typeof a.pointer&&autosave.search(a.pointer,a):"string"==typeof a&&autosave.search(a,e)}else console.error("autosave.js : cannot be loaded.\nPlease include jQuery configuration.")},search:function(a,e){var t=$(a);if(0!=t.length)for(var o=0;o<t.length;o++)autosave.load($(t[o]),e);else console.error(a+" cannot be found.")},generate:function(a){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<3;o++)e+=t.charAt(Math.floor(Math.random()*t.length));return null==a||void 0==a[e]?e:autosave.generate(a)},getToken:function(a,e){var t,o,n=autosave.config.pointer,i=autosave.config.before,r=autosave.config.success,s=autosave.config.fail,u=autosave.config.action;if("pointer"==a){o=n;for(var c in n)if(n[c].parent==e)return c}else if("before"==a){o=i;for(var c in i)if(i[c]==e)return c}else if("success"==a){o=r;for(var c in r)if(r[c]==e)return c}else if("fail"==a){o=s;for(var c in s)if(s[c]==e)return c}else if("action"==a){o=u;for(var c in u)if(u[c]==e)return c}return t=autosave.generate(o),"pointer"==a?autosave.config.pointer[t]={parent:e,child:[]}:"before"==a?autosave.config.before[t]=e:"success"==a?autosave.config.success[t]=e:"fail"==a?autosave.config.fail[t]=e:"action"==a&&(autosave.config.action[t]=e),t},isExist:function(a){return null!=a&&void 0!=a},getConfig:function(a,e){var t={};return autosave.isExist(a)&&(t.pointer=autosave.getToken("pointer",a)),autosave.isExist(e.before)&&(t.before=autosave.getToken("before",e.before)),autosave.isExist(e.success)&&(t.success=autosave.getToken("success",e.success)),autosave.isExist(e.fail)&&(t.fail=autosave.getToken("fail",e.fail)),autosave.isExist(e.action)&&(t.action=autosave.getToken("action",e.action)),t},create:function(a){var e=a.target,t=a.tag,o=a.config,n=autosave.getInfo(e,t);o.value=n.value,o=JSON.stringify(o),e.attr("data-autosave-cache",o),e.on(n.event,autosave.save)},load:function(a,e){var t="",o={},n=a.prop("tagName").toLowerCase(),i=a.children();if((t=a.attr("data-autosave-action"))&&""!=t)if(e.action=t,0==i.length){if(autosave.valid(a,n)){var r=(o=autosave.getConfig(a,e)).pointer;void 0==a.attr("data-autosave-cache")&&(autosave.config.pointer[r].child.push(a),autosave.create({target:a,config:o,tag:n}))}}else a.find("*").each(function(){var t=$(this);if(n=t.prop("tagName").toLowerCase(),autosave.valid(t,n)){var o=t.attr("data-autosave-action"),i=e;i.action=void 0==o?i.action:o;var r=autosave.getConfig(a,i),s=r.pointer;void 0==t.attr("data-autosave-cache")&&(autosave.config.pointer[s].child.push(t),autosave.create({target:t,config:r,tag:n}))}})},valid:function(a,e){if(a.attr("data-autosave-name")&&("true"==a.attr("contentEditable")||"input"==e||"checkbox"==e||"radio"==e||"textarea"==e))return!0},getInfo:function(a,e){var t=a.attr("type"),o={event:"",value:""};return"checkbox"==t||"radio"==t?(o.value=a.is(":checked"),o.event="change"):"input"==e||"textarea"==e?(o.value=a.val(),o.event="blur"):"select"==e?(o.value=a.val(),o.event="change"):(o.value=a.html(),o.event="blur"),o},getvaluelist:function(a,e){var t=autosave.config.pointer[e].child,o="";if(0==t.length)return $("."+e).val();for(var n=0;n<t.length;n++)t[n].attr("data-autosave-name")==a&&t[n].is(":checked")&&(o+=t[n].val()+"&");return o.length>0&&(o=o.substring(0,o.length-1)),o},getByGroup:function(a,e,t,o){for(var n=o.replace(/\s/g,"").split(","),i=autosave.config.pointer[e].child,r=0;r<i.length;r++)for(var s=0;s<n.length;s++)if(i[r].attr("data-autosave-name")==n[s]){a=n[s];var u=i[r],c=u.prop("tagName").toLowerCase(),v=u.attr("type"),f=autosave.getInfo(u,c).value;"checkbox"!=v&&"radio"!=v||(f=autosave.getvaluelist(a,e)),t[a]=f}return t},setfalse:function(a,e){var t=autosave.config.pointer[e].child;if(0!=t.length)for(var o=0;o<t.length;o++)if(t[o].attr("data-autosave-name")==a){var n=JSON.parse(t[o].attr("data-autosave-cache"));n.value=!1,n=JSON.stringify(n),t[o].attr("data-autosave-cache",n)}},save:function(a){var e=$(this),t=e.attr("data-autosave-name"),o=e.attr("data-autosave-group"),n=JSON.parse(e.attr("data-autosave-cache")),i=e.attr("type"),r=e.prop("tagName").toLowerCase(),s=autosave.getInfo(e,r),u=n.pointer;if(s.value!==n.value){var c=s.value,v=autosave.config.before,f=autosave.config.success,l=autosave.config.fail,g=autosave.config.action[n.action],d={};"checkbox"!=i&&"radio"!=i||(c=autosave.getvaluelist(t,u)),d[t]=c,void 0!=o&&(d=autosave.getByGroup(t,u,d,o)),void 0!=n.before&&1!=v[n.before](d)||(n.value=c,cache=JSON.stringify(n),$.ajax({method:"POST",url:g,data:d}).done(function(a){"radio"==i&&autosave.setfalse(t,u),void 0!=n.success&&f[n.success](a,e),e.attr("data-autosave-cache",cache)}).fail(function(){void 0!=n.fail&&l[n.fail](e)}))}}};